---
title: "An Introduction to ADMerge"
author: "Shijia Zhang, Xinyu Guo, Zheyu Wang"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{An Introduction to MyPackage}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Introduction
============

ADMerge is tailored for aggregating Alzheimer’s Disease (AD) biomarker data. It equips users with functionality to integrate data from diverse AD-related sources into a cohesive analytical dataset. Additionally, the package includes built-in functions that assist in summarizing the input and merged data, as well as in visualizing the analytical dataset for enhanced insights. 



```{r setup, include = FALSE}
remove.packages("ADMerge")
library(devtools)
install_github("Shijia1997/ADMerge")
library(ADMerge)
biocard_path = "BIOCARD August 2021 internal"

src_table = get_src_table(path = Biocard_path, ID_pattern = "ID", ID_usr_list = c("SUBJECT_ID","JHUANONID"), DATE_usr_list = c("date","VISITDATE","MRIDATE"))


ad_data = ad_merge(biocard_path, DATE_type = "Date",dict_src = src_table,timeline_file = "BIOCARD_CognitiveData_2021.11.02")


```

# Generating source table for data used to be merged example Biocard data, including CSF, CognitiveData, Demographics, Genetics Data and MRI Cross Sectional information

```{r}
current_dir <- getwd()

parent_dir <- dirname(current_dir)


Biocard_path <- file.path(parent_dir, "data", "BIOCARD August 2021 internal")

src_table <- get_src_table(path = Biocard_path, ID_pattern = "ID")

print(src_table)

```
### The Demographics and Genetics File were automatically identified as Non-logitudial data because the software can't find date related columns in those files. The determine of whether the file input is longitudial can be also specified mannually using the input variable: "non_longitudinal_list", the file name in that variable were automatically considered as "Non-longitudinal" and will be join solely based on ID specified. We can either specify the priority level for the software to determine the ID and Date/visit number using reugular expression defualt "DATE|VISITNO". The earlier input to the lists "Dd_user_list" and "Date_user_list" will be considered higher priority to join. The entire source table is a Dataframe object that can be modified directly in R for users to specify. The time window is determined by the window length (specified by the WINDOW column in the source structure table) and the overlap property (specified by the IS_overlap column in the source structure table). For each desired visit Ti, a time window is created by adding half of the window length (d) on both sides—[Ti - d, Ti + d]. If the overlap property is true, the window boundaries Ti-d and Ti+d will be compared with the middle points between the previous visit and current visit (Ti-1 + Ti)/2 as well as the middle points between the current visit and latter visit (Ti + Ti+1)/2. The new window will then be modified to [max(Ti - d, (Ti-1 + Ti)/2), min(Ti + d, (Ti + Ti+1)/2 )] to avoid using any biomarker measure multiple times. The defualt for IS_overlap is False and the defualt for WINDOW is 366.  

# Manually modify the source table with determined priority of ID and Date for joining.

```{r}
src_table <- get_src_table(path = Biocard_path, ID_pattern = "ID", ID_usr_list = c("SUBJECT_ID","JHUANONID"), DATE_usr_list = c("date","VISITDATE","MRIDATE"))

print(src_table)
```
### From here we used build in function for the package to choose the ID and Date for Joining. The input c("SUBJECT_ID","JHUANONID") in ID_usr_list making the package finding "SUBJECT_ID" for join, if not found in the viariables of the data file, the package will choose "JHUANONID" as second choice. Same for the varaibles input in the DATE_usr_list. Agian the entire source table (scr_table) is a Dataframe Object and modifiable using R. The Merging of the file will be based on the source table.

```{r}
biocard_merged = ad_merge(Biocard_path, dict_src = src_table,timeline_file = "BIOCARD_CognitiveData_2021.11.02")

biocard_merged$analysis_data

## This issue still need to be fixed !!!! ( the input typec)

```

```{r}
biocard_merged = ad_merge(Biocard_path, dict_src = src_table,timeline_file = "BIOCARD_CognitiveData_2021.11.02")

biocard_merged$analysis_data
\
```

